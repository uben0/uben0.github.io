<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Tutoriel Rust</title>
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
<a href="index.html#c
39
" class="index-link">← retour</a>
<h1 id="jeu-déchecs-3">Jeu d’échecs (3)</h1>
<h2 id="saisir-le-mouvement-de-pièce">Saisir le mouvement de pièce</h2>
<p>On souhaite que l’utilisateur entre les coordonnés de la pièce qu’il souhaite déplacer ainsi que les coordonnés où il souhaite la déplacer. Par exemple <code>"e5f6"</code> ou encore <code>"a1a2"</code>.</p>
<p>Créons une structure représentant un mouvement:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Debug</span><span class="op">,</span> <span class="bu">Clone</span><span class="op">,</span> <span class="bu">Copy</span><span class="op">,</span> <span class="bu">PartialEq</span><span class="op">,</span> <span class="bu">Eq</span><span class="at">)]</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Move <span class="op">{</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    src_x<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    src_y<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    dst_x<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    dst_y<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Créons une fonction qui interprète ce que rentre l’utilisateur pour renvoyer un <code>Move</code>. Je fournie la fonction <code>user_input</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> user_input<span class="op">&lt;</span>T<span class="op">:</span> <span class="pp">std::</span><span class="dt">str</span><span class="pp">::</span><span class="bu">FromStr</span><span class="op">&gt;</span>() <span class="op">-&gt;</span> T</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> <span class="op">&lt;</span>T <span class="kw">as</span> <span class="pp">std::</span><span class="dt">str</span><span class="pp">::</span><span class="bu">FromStr</span><span class="op">&gt;</span><span class="pp">::</span><span class="cn">Err</span><span class="op">:</span> <span class="pp">std::fmt::</span><span class="bu">Debug</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> l <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">std::io::</span>stdin()<span class="op">.</span>read_line(<span class="op">&amp;</span><span class="kw">mut</span> l)<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">T::</span>from_str(l<span class="op">.</span>as_str()<span class="op">.</span>trim())<span class="op">.</span>unwrap()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Commençons par le prototype.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_user_move() <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Move<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Dans un premier temps, on récupère ce que l’utilisateur a tapé dans une <code>String</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_user_move() <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Move<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;enter move:&quot;</span>)<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> s<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> user_input()<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Maintenant on veut faire correspondre les lettres de <code>'a'</code> jusqu’à <code>'h'</code> à des indice de <code>0</code> à <code>7</code> inclu.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_user_move() <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Move<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;enter move:&quot;</span>)<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> s<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> user_input()<span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> src_x <span class="op">=</span> <span class="kw">match</span> s[<span class="dv">0</span>] <span class="op">{</span> <span class="co">// ERROR</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;a&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;b&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;c&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;d&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;e&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;f&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;g&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;h&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>On ne peut pas faire <code>s[0]</code> car <code>s</code> est une <code>String</code> qui représente une chaîne de caractère unicode encodé en UTF8. Hors un caractère unicode en UTF8 peut faire un ou plusieurs octets de large, et par convention, l’opérateur d’indexion <code>[n]</code> doit avoir une complixité constante, hors avec des caractères ayant des tailles variables, il est impossible de connaitre à l’avance l’emplacement du n-ième caractère. Mais il y a une solution.</p>
<p>On peut utiliser un itérateur (la méthode <code>chars</code> de <code>String</code> retourne un itérateur sur les caractères). La méthode <code>nth</code> d’un itérateur retourne le n-ième élément de l’itérateur.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> s <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>from(<span class="st">&quot;こんにちは世界&quot;</span>)<span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="pp">println!</span>(<span class="st">&quot;{:?}&quot;</span><span class="op">,</span> s<span class="op">.</span>chars()<span class="op">.</span>nth(<span class="dv">3</span>))<span class="op">;</span></span></code></pre></div>
<pre><code>Some(&#39;ち&#39;)</code></pre>
<p>Corrigeons notre code.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_user_move() <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Move<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;enter move:&quot;</span>)<span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> s<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> user_input()<span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> iter <span class="op">=</span> s<span class="op">.</span>chars()<span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> src_x <span class="op">=</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;a&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;b&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;c&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;d&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;e&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;f&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;g&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;h&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>En utilisant l’opérateur <code>?</code>, on gère le cas où <code>next</code> retournerai <code>None</code>.</p>
<p>On peut compresser le code.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_user_move() <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Move<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;enter move:&quot;</span>)<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> s<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> user_input()<span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> iter <span class="op">=</span> s<span class="op">.</span>chars()<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> src_x <span class="op">=</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;a&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;b&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;c&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;d&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;e&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;f&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;g&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;h&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>On fait cette conversion avec les trois autres caractères:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_user_move() <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Move<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;enter move:&quot;</span>)<span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> s<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> user_input()<span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> iter <span class="op">=</span> s<span class="op">.</span>chars()<span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> src_x <span class="op">=</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;a&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;b&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;c&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;d&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;e&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;f&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;g&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;h&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> src_y <span class="op">=</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;1&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;2&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;3&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;4&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;5&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;6&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;7&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;8&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> dst_x <span class="op">=</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;a&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;b&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;c&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;d&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;e&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;f&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;g&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;h&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> dst_y <span class="op">=</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;1&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;2&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;3&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;4&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;5&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;6&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;7&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;8&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>On retourne un <code>Move</code> ensuite:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_user_move() <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Move<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;enter move:&quot;</span>)<span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> s<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> user_input()<span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> iter <span class="op">=</span> s<span class="op">.</span>chars()<span class="op">;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> src_x <span class="op">=</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;a&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;b&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;c&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;d&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;e&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;f&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;g&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;h&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> src_y <span class="op">=</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;1&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;2&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;3&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;4&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;5&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;6&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;7&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;8&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> dst_x <span class="op">=</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;a&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;b&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;c&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;d&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;e&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;f&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;g&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;h&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> dst_y <span class="op">=</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;1&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;2&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;3&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;4&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;5&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;6&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;7&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;8&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Some</span>(Move <span class="op">{</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>        src_x<span class="op">:</span> src_x<span class="op">,</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        src_y<span class="op">:</span> src_y<span class="op">,</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        dst_x<span class="op">:</span> dst_x<span class="op">,</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        dst_y<span class="op">:</span> dst_y<span class="op">,</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>On peut encore racourcir le code:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_user_move() <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Move<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;enter move:&quot;</span>)<span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> s<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> user_input()<span class="op">;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> iter <span class="op">=</span> s<span class="op">.</span>chars()<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Some</span>(Move <span class="op">{</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        src_x<span class="op">:</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>            <span class="ch">&#39;a&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;b&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;c&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;d&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            <span class="ch">&#39;e&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;f&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;g&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;h&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>            _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        src_y<span class="op">:</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>            <span class="ch">&#39;1&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;2&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;3&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;4&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>            <span class="ch">&#39;5&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;6&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;7&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;8&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>            _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        dst_x<span class="op">:</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            <span class="ch">&#39;a&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;b&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;c&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;d&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>            <span class="ch">&#39;e&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;f&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;g&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;h&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>            _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        dst_y<span class="op">:</span> <span class="kw">match</span> iter<span class="op">.</span>next()<span class="op">?</span> <span class="op">{</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>            <span class="ch">&#39;1&#39;</span> <span class="op">=&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="ch">&#39;2&#39;</span> <span class="op">=&gt;</span> <span class="dv">1</span><span class="op">,</span> <span class="ch">&#39;3&#39;</span> <span class="op">=&gt;</span> <span class="dv">2</span><span class="op">,</span> <span class="ch">&#39;4&#39;</span> <span class="op">=&gt;</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>            <span class="ch">&#39;5&#39;</span> <span class="op">=&gt;</span> <span class="dv">4</span><span class="op">,</span> <span class="ch">&#39;6&#39;</span> <span class="op">=&gt;</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">&#39;7&#39;</span> <span class="op">=&gt;</span> <span class="dv">6</span><span class="op">,</span> <span class="ch">&#39;8&#39;</span> <span class="op">=&gt;</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>            _ <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">None</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>On souhaiterait une fonction qui boucle tant que l’utilisateur n’a pas rentré un mouvement syntaxiquement correct.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_user_move_loop() <span class="op">-&gt;</span> Move <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">loop</span> <span class="op">{</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(m) <span class="op">=</span> get_user_move() <span class="op">{</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> m</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">&quot;invalid syntax&quot;</span>)<span class="op">;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="progression-du-projet">Progression du projet</h2>
<p>Trouves dans le fichier <a href="https://gitlab.com/uben0/rust-tutoriel-fr/-/raw/master/39/main.rs"><code>main.rs</code></a> le projet.</p>
    </body>
</html>